<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¤©æ°£å¡ç‰‡èˆ‡åœ–è¡¨</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f5f7fa;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 16px;
      padding: 16px;
      margin: 12px;
      width: 280px;
      background: white;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: inline-block;
      vertical-align: top;
    }
    .card h3 { margin-top: 0; font-size: 1.1em; }
    .card p { margin: 4px 0; }
    canvas { max-width: 100%; margin: 30px auto; }
  </style>
</head>
<body>

  <h2 id="location-title">ğŸ“ è¼‰å…¥ä¸­...</h2>

  <!-- å¡ç‰‡å®¹å™¨ -->
  <div id="weather-container"></div>

  <!-- åœ–è¡¨å®¹å™¨ -->
  <h3>ğŸ“ˆ æ°£æº«è®ŠåŒ–åœ–</h3>
  <canvas id="temperatureChart" height="120"></canvas>

  <h3>ğŸ“‰ æ¿•åº¦è¶¨å‹¢åœ–</h3>
  <canvas id="humidityChart" height="120"></canvas>

  <script>
    fetch("data/weather_data.json")
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("weather-container");
        document.getElementById("location-title").textContent =
          `ğŸ“ ${data.city} ${data.district} - æœªä¾†å¤©æ°£é å ±`;

        const labels = [];
        const temps = [];
        const humids = [];

        data.weather_data.forEach(entry => {
          const time = entry["æ™‚é–“"];
          const temp = parseFloat(entry["æº«åº¦"]);
          const humid = parseFloat(entry["ç›¸å°æ¿•åº¦"]);

          // ğŸ‘‰ ç•«åœ–è³‡æ–™
          if (!isNaN(temp)) {
            labels.push(time.split("T")[1]?.substring(0,5) || time); // å– hh:mm
            temps.push(temp);
          }
          if (!isNaN(humid)) humids.push(humid);

          // ğŸ‘‰ å¡ç‰‡æ¸²æŸ“
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
            <h3>ğŸ•’ ${time}</h3>
            ${entry["æº«åº¦"] ? `<p>ğŸŒ¡ï¸ æº«åº¦: ${entry["æº«åº¦"]}Â°C</p>` : ""}
            ${entry["é«”æ„Ÿæº«åº¦"] ? `<p>ğŸ¥µ é«”æ„Ÿ: ${entry["é«”æ„Ÿæº«åº¦"]}Â°C</p>` : ""}
            ${entry["ç›¸å°æ¿•åº¦"] ? `<p>ğŸ’§ æ¿•åº¦: ${entry["ç›¸å°æ¿•åº¦"]}%</p>` : ""}
            ${entry["3å°æ™‚é™é›¨æ©Ÿç‡"] ? `<p>ğŸŒ§ï¸ é™é›¨: ${entry["3å°æ™‚é™é›¨æ©Ÿç‡"]}%</p>` : ""}
            ${entry["é¢¨å‘"] || entry["é¢¨é€Ÿ"] ? `<p>ğŸ’¨ é¢¨: ${entry["é¢¨å‘"] || ""} ${entry["é¢¨é€Ÿ"] || ""}</p>` : ""}
            ${entry["èˆ’é©åº¦æŒ‡æ•¸"] ? `<p>ğŸ™‚ èˆ’é©åº¦: ${entry["èˆ’é©åº¦æŒ‡æ•¸"]}</p>` : ""}
            ${entry["å¤©æ°£é å ±ç¶œåˆæè¿°"] ? `<p>ğŸ“ ${entry["å¤©æ°£é å ±ç¶œåˆæè¿°"]}</p>` : ""}
          `;
          container.appendChild(card);
        });

        // ğŸ‘‰ Chart.js - æº«åº¦åœ–
        new Chart(document.getElementById("temperatureChart"), {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'æº«åº¦ (Â°C)',
              data: temps,
              borderWidth: 2,
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: true } }
          }
        });

        // ğŸ‘‰ Chart.js - æ¿•åº¦åœ–
        new Chart(document.getElementById("humidityChart"), {
          type: 'line',
          data: {
            labels: labels.slice(0, humids.length),  // åŒæ­¥ X è»¸
            datasets: [{
              label: 'ç›¸å°æ¿•åº¦ (%)',
              data: humids,
              borderWidth: 2,
              tension: 0.3
            }]
          },
          options: {
            responsive: true,
            plugins: { legend: { display: true } }
          }
        });
      });
  </script>

</body>
</html>
